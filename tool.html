<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Code Print with Highlight.js</title>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/monokai-sublime.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- and it's easy to individually load additional languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>

    <script>hljs.highlightAll();</script>
    <style>
        .float-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }
        .wrapper {
            /* position: absolute;
            bottom: 100px; */
            display: flex;
            justify-content: flex-start;
            margin-left: 30px;
            width: auto;
        }
        pre code.hljs {
            border-radius: .5em !important;
            padding: 0 3em 2em 0 !important;
        }
        body {
            background: rgb(22,255,39)
        }
    </style>
</head>

<body>
    <div id="mycode-pre" style="visibility: hidden; height: 0;"></div>
    <div class="wrapper">
        <pre><code id="myCode" class="language-python"></code></pre>
    </div>
    <button class="float-button" onclick="printCode()">Print Code</button>
</body>

<script>

    function printCode() {
        var code = document.getElementById("mycode-pre").textContent;
        var speed = 10; // 设置输出速度

        // 高亮代码
        hljs.highlightElement(document.getElementById("myCode"));

        // 模拟打印
        var index = 0;

        // 设置定时器，每隔 speed 毫秒输出一个字符
        var timer = setInterval(function () {
            document.getElementById("myCode").innerHTML += code.charAt(index);
            index++;

            document.querySelectorAll('pre code').forEach((el) => {
                hljs.highlightElement(el);
            });

            if (index === code.length) {
                clearInterval(timer);
            }
        }, speed);
    }

    // 要打印的代码
    var code = `
    import numpy as np
    from sklearn.neighbors import NearestNeighbors

    # 模拟的数据：5部电影，5位用户
    # 每行代表一个用户对5部电影的评分（评分范围1-5，0表示未评分）
    ratings = np.array([
        [5, 3, 0, 0, 2],
        [0, 4, 4, 3, 1],
        [2, 0, 5, 0, 0],
        [0, 0, 4, 5, 0],
        [3, 2, 0, 2, 3]
    ])

    # 使用KNN找到与当前用户最相似的用户
    # 这里选择3个最近邻居
    knn = NearestNeighbors(n_neighbors=3, metric='cosine', algorithm='brute')
    knn.fit(ratings)

    # 假设当前用户的评分是：[3, 0, 5, 0, 3]
    current_user_rating = np.array([[3, 0, 5, 0, 3]])
    distances, indices = knn.kneighbors(current_user_rating)

    # 计算平均评分，但要忽略评分为0的部分
    neighbors_ratings = ratings[indices][0]  # 提取邻居的评分
    sum_ratings = np.sum(neighbors_ratings, axis=0)
    count_nonzero = np.count_nonzero(neighbors_ratings, axis=0)

    # 避免除以0
    mean_ratings = np.divide(sum_ratings, count_nonzero, out=np.zeros_like(sum_ratings, dtype=float), where=count_nonzero != 0)

    # 打印出2号和4号电影（索引1和3）的预测评分
    print(f"预测的2号电影评分为: {mean_ratings[1]}")
    print(f"预测的4号电影评分为: {mean_ratings[3]}")


   `;


    // 将代码放入 pre 标签中
    document.getElementById("mycode-pre").textContent = code;

</script>

</html>